kind: pipeline
type: docker
name: fupanhezi-admin

volumes:
- name: pip
  host:
    path: /tmp/cache/.pip
- name: npm
  host:
    path: /tmp/cache/.npm

steps:
  - name: docker
    image: plugins/docker
    volumes:
    - name: pip
      path: /root/.cache/pip
    settings:
      repo: ccr.ccs.tencentyun.com/franktrue/fupanhezi-admin-api
      registry: ccr.ccs.tencentyun.com
      password: 
        from_secret: tencent_tcr_password
      username: 
        from_secret: tencent_id
      dockerfile: docker_env/django/Dockerfile
      tags:
      - latest
      - dev

  - name: publish-celery
    image: plugins/docker
    volumes:
    - name: pip
      path: /root/.cache/pip
    settings:
      repo: ccr.ccs.tencentyun.com/franktrue/fupanhezi-admin-celery
      registry: ccr.ccs.tencentyun.com
      password: 
        from_secret: tencent_tcr_password
      username: 
        from_secret: tencent_id
      dockerfile: docker_env/celery/Dockerfile
      tags:
      - latest
      - dev
  
  - name: publish-web
    image: plugins/docker
    volumes:
    - name: npm
      path: /tmp/cache/.npm
    settings:
      repo: ccr.ccs.tencentyun.com/franktrue/fupanhezi-admin-web
      registry: ccr.ccs.tencentyun.com
      password: 
        from_secret: tencent_tcr_password
      username: 
        from_secret: tencent_id
      dockerfile: docker_env/web/Dockerfile
      tags:
      - latest
      - dev