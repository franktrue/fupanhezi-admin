kind: pipeline
type: docker
name: fupanhezi-admin

steps:
  - name: publish-api
    image: plugins/buildah-docker
    settings:
      repo: ccr.ccs.tencentyun.com/franktrue/fupanhezi-admin-api
      registry: ccr.ccs.tencentyun.com
      password: 
        from_secret: tencent_tcr_password
      username: 
        from_secret: tencent_id
      dockerfile: docker_env/django/Dockerfile
      tags: dev

  - name: publish-celery
    image: plugins/buildah-docker
    settings:
      repo: ccr.ccs.tencentyun.com/franktrue/fupanhezi-admin-celery
      registry: ccr.ccs.tencentyun.com
      password: 
        from_secret: tencent_tcr_password
      username: 
        from_secret: tencent_id
      dockerfile: docker_env/celery/Dockerfile
      tags: dev
  
  - name: publish-web
    image: plugins/buildah-docker
    settings:
      repo: ccr.ccs.tencentyun.com/franktrue/fupanhezi-admin-web
      registry: ccr.ccs.tencentyun.com
      password: 
        from_secret: tencent_tcr_password
      username: 
        from_secret: tencent_id
      dockerfile: docker_env/web/Dockerfile
      tags: dev